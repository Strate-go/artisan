<!-- 
=======================================================
CARTE INTERACTIVE STRATÉGO - VERSION FINALE PROPRE
=======================================================
INSTRUCTIONS :
1. Copiez TOUT ce code
2. Dans Squarespace : Ajoutez un "Bloc de code"
3. Collez ce code dans le bloc
4. Sauvegardez et publiez !
=======================================================
-->

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;700&family=Raleway:wght@400;700&display=swap" rel="stylesheet">

<!-- Container principal -->
<div id="stratego-final-map" style="width: 100%; max-width: none; margin: 0; padding: 0;">

<div class="stratego-container">
    <!-- Section avec texte à gauche et carte à droite -->
    <section class="main-section">
        <div class="section-content">
            <!-- Section 1 : Rentabilité -->
            <div class="content-block active" data-content="1">
                <h2>Votre <span class="highlight">rentabilité</span>, ce grand brouillard.</h2>
                <p class="section-description">
                    Vous terminez un chantier, la satisfaction du travail bien fait est là. Mais rapidement, la question qui fâche revient : "Combien ai-je vraiment gagné sur ce projet ?".
                </p>
                
                <div class="challenges">
                    <div class="challenge">
                        <h3>Fixer le juste prix</h3>
                        <p>Quel taux horaire pour valoriser votre savoir-faire ? Quel coefficient appliquer sur les fournitures ?</p>
                    </div>
                    <div class="challenge">
                        <h3>Facturer chaque minute</h3>
                        <p>Comment être sûr de ne pas oublier les temps de trajet, les allers-retours imprévus chez le fournisseur ?</p>
                    </div>
                    <div class="challenge">
                        <h3>Analyser le passé</h3>
                        <p>Savoir précisément sur quel chantier vous avez gagné de l'argent, et surtout, lequel vous en a fait perdre.</p>
                    </div>
                </div>
            </div>

            <!-- Section 2 : Trésorerie -->
            <div class="content-block" data-content="2">
                <h2>La <span class="highlight">trésorerie</span> en dents de scie : piloter à vue en permanence</h2>
                <p class="section-description">
                    Votre compte en banque ressemble aux montagnes russes. Cette absence de visibilité vous empêche de vous projeter et génère un stress constant.
                </p>
                
                <div class="challenges">
                    <div class="challenge">
                        <h3>Le décalage permanent</h3>
                        <p>Vous payez vos matériaux et vos charges aujourd'hui, mais vos clients, eux, vous paieront dans 30, 60, voire 90 jours.</p>
                    </div>
                    <div class="challenge">
                        <h3>Le coût du stock</h3>
                        <p>Vous financez des matières premières qui dorment à l'atelier ou dans la camionnette, sans savoir quand elles se transformeront en chiffre d'affaires.</p>
                    </div>
                    <div class="challenge">
                        <h3>L'absence de visibilité</h3>
                        <p>Impossible de savoir sereinement ce dont vous disposerez dans 3 mois pour payer l'URSSAF, la TVA ou simplement votre salaire.</p>
                    </div>
                </div>
            </div>

            <!-- Section 3 : Croissance -->
            <div class="content-block" data-content="3" style="min-height: 800px;">
                <h2>Investir, recruter : seul face aux grandes <span class="highlight">décisions</span>.</h2>
                <p class="section-description">
                    Votre carnet de commandes se remplit, votre réputation grandit. Viennent alors les grandes décisions qui peuvent faire passer votre entreprise à l'étape supérieure.
                </p>
                
                <div class="challenges">
                    <div class="challenge">
                        <h3>Le pari matériel</h3>
                        <p>Est-ce le bon moment d'investir dans cette nouvelle machine ? De changer de véhicule ? Pouvez-vous vraiment vous le permettre ?</p>
                    </div>
                    <div class="challenge">
                        <h3>Le défi humain</h3>
                        <p>L'idée d'embaucher votre premier salarié ou un apprenti vous tente, mais les démarches et les responsabilités vous semblent être une véritable montagne.</p>
                    </div>
                    <div class="challenge">
                        <h3>La peur du risque</h3>
                        <p>Chaque grande décision ressemble à un pari sur l'avenir, et vous avez le sentiment de le faire seul, sans filet de sécurité pour valider vos intuitions.</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- CARTE INTERACTIVE UNIQUE -->
        <div class="single-interactive-map">
            <!-- PROBLÈMES (Section 1 - Rentabilité) -->
            <div class="tile problem" data-tile="devis" data-section="1" style="grid-column: 1; grid-row: 2;">
                <div class="tile-icon">
                    <svg width="32" height="32" viewBox="0 0 334 334" fill="currentColor">
                        <path d="M170 110.5V34H93.5C86.737 34 80.251 36.6866 75.4688 41.4688C70.6866 46.251 68 52.737 68 59.5V280.5C68 287.263 70.6866 293.749 75.4688 298.531C80.251 303.313 86.737 306 93.5 306H246.5C253.263 306 259.749 303.313 264.531 298.531C269.313 293.749 272 287.263 272 280.5V227.953L279.293 218.399L281.69L192.933 288.065C185.977 289.818 178.635 289.188 172.08 286.275C165.525 283.363 160.135 278.337 156.774 272H110.5C108.246 272 106.084 271.104 104.49 269.51C102.896 267.916 102 265.754 102 263.5C102 261.246 102.896 259.084 104.49 257.49C106.084 255.896 108.246 255 110.5 255H153.068C153.2 253.011 153.508 251.037 153.986 249.101L160.361 223.635C162.749 214.083 167.684 205.358 174.641 198.39L237.048 136H195.5C188.737 136 182.251 133.313 177.469 128.531C172.687 123.749 170 117.263 170 110.5ZM261.137 112.387C259.605 113.605 258.137 114.91 256.751 116.297L254.031 119.031L193.5 118.997C195.566 119.82 191.084 118.949 116.51C187.896 114.916 187 112.754 187 110.5V38.25L261.137 112.387ZM186.66 210.409L268.77 128.299C271.724 125.348 275.23 123.007 279.088 121.411C282.946 119.814 287.081 118.993 291.256 118.995C295.431 118.997 299.566 119.82 303.423 121.42C307.279 123.019 310.784 125.362 313.735 128.316C316.686 131.27 319.027 134.776 320.623 138.634C322.22 142.492 323.041 146.627 323.039 150.802C323.037 154.977 322.214 159.112 320.614 162.969C319.015 166.825 316.672 170.33 313.718 173.281L231.608 255.374C226.823 260.157 220.83 263.553 214.268 265.2L188.802 271.558C186.27 272.189 183.617 272.154 181.103 271.457C178.588 270.76 176.296 269.425 174.45 267.58C172.604 265.736 171.266 263.445 170.567 260.931C169.867 258.417 169.83 255.765 170.459 253.232L176.834 227.766C178.481 221.204 181.877 215.211 186.66 210.426Z"/>
                    </svg>
                </div>
                <div class="tile-title">Devis</div>
            </div>

            <div class="tile problem" data-tile="materiaux" data-section="1" style="grid-column: 3; grid-row: 1;">
                <div class="tile-icon">
                    <svg width="32" height="32" viewBox="0 0 340 340" fill="currentColor">
                        <path d="M168 271.938C168 274.93 166.32 277.529 163.76 278.867L100.56 313.832C99.28 314.777 97.68 315.25 96 315.25C94.32 315.25 92.72 314.777 91.44 313.832L28.24 278.867C26.9568 278.205 25.883 277.208 25.1354 275.986C24.3878 274.764 23.9951 273.364 24 271.938V201.062C24 198.07 25.68 195.471 28.24 194.132L91.44 159.168C92.72 158.223 94.32 157.75 96 157.75C97.68 157.75 99.28 158.223 100.56 159.168L163.76 194.132C166.32 195.471 168 198.07 168 201.062V271.938ZM96 174.681L48.32 201.062L96 227.444L143.68 201.062L96 174.681ZM40 267.291L88 293.909V241.067L40 214.529V267.291ZM152 267.291V214.529L104 241.067V293.909L152 267.291Z"/>
                        <path d="M316 271.938C316 274.93 314.32 277.529 311.76 278.867L248.56 313.832C247.28 314.777 245.68 315.25 244 315.25C242.32 315.25 240.72 314.777 239.44 313.832L176.24 278.867C174.957 278.205 173.883 277.208 173.135 275.986C172.388 274.764 171.995 273.364 172 271.938V201.062C172 198.07 173.68 195.471 176.24 194.132L239.44 159.168C240.72 158.223 242.32 157.75 244 157.75C245.68 157.75 247.28 158.223 248.56 159.168L311.76 194.132C314.32 195.471 316 198.07 316 201.062V271.938ZM244 174.681L196.32 201.062L244 227.444L291.68 201.062L244 174.681ZM188 267.291L236 293.909V241.067L188 214.529V267.291ZM300 267.291V214.529L252 241.067V293.909L300 267.291Z"/>
                        <path d="M241 148.938C241 151.93 239.32 154.529 236.76 155.867L173.56 190.832C172.28 191.777 170.68 192.25 169 192.25C167.32 192.25 165.72 191.777 164.44 190.832L101.24 155.867C99.9568 155.205 98.883 154.208 98.1354 152.986C97.3878 151.764 96.9951 150.364 97 148.938V78.0625C97 75.07 98.68 72.4712 101.24 71.1325L164.44 36.1675C165.72 35.2225 167.32 34.75 169 34.75C170.68 34.75 172.28 35.2225 173.56 36.1675L236.76 71.1325C239.32 72.4712 241 75.07 241 78.0625V148.938ZM169 51.6813L121.32 78.0625L169 104.444L216.68 78.0625L169 51.6813ZM113 144.291L161 170.909V118.067L113 91.5288V144.291ZM225 144.291V91.5288L177 118.067V170.909L225 144.291Z"/>
                    </svg>
                </div>
                <div class="tile-title">Matières Premières</div>
            </div>

            <div class="tile problem" data-tile="temps" data-section="1" style="grid-column: 4; grid-row: 2;">
                <div class="tile-icon">
                    <svg width="32" height="32" viewBox="0 0 334 334" fill="currentColor">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M131.042 28.3333C131.042 25.5154 132.161 22.8129 134.154 20.8203C136.146 18.8278 138.849 17.7083 141.667 17.7083H198.333C201.151 17.7083 203.854 18.8278 205.846 20.8203C207.839 22.8129 208.958 25.5154 208.958 28.3333C208.958 31.1513 207.839 33.8538 205.846 35.8464C203.854 37.8389 201.151 38.9583 198.333 38.9583H141.667C138.849 38.9583 136.146 37.8389 134.154 35.8464C132.161 33.8538 131.042 31.1513 131.042 28.3333ZM170 67.2917C139.003 67.2917 109.275 79.6053 87.3569 101.524C65.4386 123.442 53.125 153.17 53.125 184.167C53.125 215.164 65.4386 244.891 87.3569 266.81C109.275 288.728 139.003 301.042 170 301.042C200.997 301.042 230.725 288.728 252.643 266.81C274.561 244.891 286.875 215.164 286.875 184.167C286.875 153.17 274.561 123.442 252.643 101.524C230.725 79.6053 200.997 67.2917 170 67.2917ZM31.875 184.167C31.875 107.879 93.7125 46.0417 170 46.0417C246.288 46.0417 308.125 107.879 308.125 184.167C308.125 260.454 246.288 322.292 170 322.292C93.7125 322.292 31.875 260.454 31.875 184.167ZM170 116.875C172.818 116.875 175.52 117.994 177.513 119.987C179.506 121.98 180.625 124.682 180.625 127.5V184.167C180.625 186.985 179.506 189.687 177.513 191.68C175.52 193.672 172.818 194.792 170 194.792C167.182 194.792 164.48 193.672 162.487 191.68C160.494 189.687 159.375 186.985 159.375 184.167V127.5C159.375 124.682 160.494 121.98 162.487 119.987C164.48 117.994 167.182 116.875 170 116.875Z"/>
                    </svg>
                </div>
                <div class="tile-title">Temps de Travail</div>
            </div>

            <!-- PROBLÈMES (Section 2 - Trésorerie) -->
            <div class="tile problem" data-tile="fournisseurs" data-section="2" style="grid-column: 1; grid-row: 4;">
                <div class="tile-icon">
                    <svg width="32" height="32" viewBox="0 0 237 236" fill="currentColor">
                        <path d="M70 220C64.5 220 59.7933 218.043 55.88 214.13C51.9667 210.217 50.0067 205.507 50 200C49.9933 194.493 51.9533 189.787 55.88 185.88C59.8067 181.973 64.5133 180.013 70 180C75.4867 179.987 80.1967 181.947 84.13 185.88C88.0633 189.813 90.02 194.52 90 200C89.98 205.48 88.0233 210.19 84.13 214.13C80.2367 218.07 75.5267 220.027 70 220ZM170 220C164.5 220 159.793 218.043 155.88 214.13C151.967 210.217 150.007 205.507 150 200C149.993 194.493 151.953 189.787 155.88 185.88C159.807 181.973 164.513 180.013 170 180C175.487 179.987 180.197 181.947 184.13 185.88C188.063 189.813 190.02 194.52 190 200C189.98 205.48 188.023 210.19 184.13 214.13C180.237 218.07 175.527 220.027 170 220ZM52 40H199.5C203.333 40 206.25 41.71 208.25 45.13C210.25 48.55 210.333 52.0067 208.5 55.5L173 119.5C171.167 122.833 168.71 125.417 165.63 127.25C162.55 129.083 159.173 130 155.5 130H81L70 150H190V170H70C62.5 170 56.8333 166.71 53 160.13C49.1667 153.55 49 147.007 52.5 140.5L66 116L30 40H10V20H42.5L52 40Z"/>
                    </svg>
                </div>
                <div class="tile-title">Fournisseurs / Achats</div>
            </div>

            <div class="tile problem" data-tile="charges" data-section="2" style="grid-column: 4; grid-row: 3;">
                <div class="tile-icon">
                    <svg width="32" height="32" viewBox="0 0 240 240" fill="currentColor">
                        <path d="M120 128C109 128 99.5833 124.083 91.75 116.25C83.9167 108.417 80 99 80 88C80 77 83.9167 67.5833 91.75 59.75C99.5833 51.9167 109 48 120 48C131 48 140.417 51.9167 148.25 59.75C156.083 67.5833 160 77 160 88C160 99 156.083 108.417 148.25 116.25C140.417 124.083 131 128 120 128ZM40 208V180C40 174.333 41.46 169.127 44.38 164.38C47.3 159.633 51.1733 156.007 56 153.5C66.3333 148.333 76.8333 144.46 87.5 141.88C98.1667 139.3 109 138.007 120 138C131 137.993 141.833 139.287 152.5 141.88C163.167 144.473 173.667 148.347 184 153.5C188.833 156 192.71 159.627 195.63 164.38C198.55 169.133 200.007 174.34 200 180V208H40Z"/>
                        <path d="M182 218.75C177.158 218.75 172.608 217.798 168.35 215.893C164.092 213.989 160.388 211.407 157.238 208.147C154.088 204.887 151.594 201.05 149.758 196.637C147.922 192.225 147.002 187.512 147 182.5C146.998 177.488 147.917 172.775 149.758 168.362C151.599 163.95 154.092 160.113 157.238 156.853C160.383 153.593 164.087 151.011 168.35 149.107C172.613 147.202 177.163 146.25 182 146.25C186.837 146.25 191.387 147.202 195.65 149.107C199.913 151.011 203.617 153.593 206.763 156.853C209.908 160.113 212.402 163.95 214.246 168.362C216.089 172.775 217.007 177.488 217 182.5C216.993 187.512 216.074 192.225 214.242 196.637C212.41 201.05 209.917 204.887 206.763 208.147C203.608 211.407 199.904 213.99 195.65 215.897C191.396 217.804 186.846 218.755 182 218.75Z" fill-rule="evenodd" clip-rule="evenodd" style="fill:white; mix-blend-mode:difference;"/>
                        <path d="M184 203C178.756 203 174.089 201.511 170 198.533C165.911 195.556 163.022 191.711 161.333 187H154.667C153.911 187 153.278 186.744 152.768 186.232C152.258 185.72 152.002 185.087 152 184.333C151.998 183.58 152.254 182.947 152.768 182.435C153.282 181.923 153.915 181.667 154.667 181.667H160.133C160.044 181.178 160 180.733 160 180.333V177.667C160 177.267 160.044 176.822 160.133 176.333H154.667C153.911 176.333 153.278 176.077 152.768 175.565C152.258 175.053 152.002 174.42 152 173.667C151.998 172.913 152.254 172.28 152.768 171.768C153.282 171.256 153.915 171 154.667 171H161.333C163.022 166.289 165.911 162.444 170 159.467C174.089 156.489 178.756 155 184 155C186.533 155 188.911 155.367 191.133 156.101C193.356 156.836 195.444 157.846 197.4 159.133C198.156 159.622 198.545 160.311 198.568 161.2C198.591 162.089 198.291 162.844 197.667 163.467C197.043 164.089 196.265 164.456 195.333 164.568C194.402 164.68 193.535 164.491 192.733 164C191.444 163.244 190.056 162.667 188.568 162.267C187.08 161.867 185.557 161.667 184 161.667C180.667 161.667 177.633 162.523 174.899 164.235C172.164 165.947 170.087 168.202 168.667 171H181.333C182.089 171 182.723 171.256 183.235 171.768C183.747 172.28 184.002 172.913 184 173.667C183.998 174.42 183.742 175.054 183.232 175.568C182.722 176.082 182.089 176.337 181.333 176.333H166.933C166.844 176.822 166.778 177.267 166.733 177.667C166.689 178.067 166.667 178.511 166.667 179C166.667 179.489 166.689 179.933 166.733 180.333C166.778 180.733 166.844 181.178 166.933 181.667H181.333C182.089 181.667 182.723 181.923 183.235 182.435C183.747 182.947 184.002 183.58 184 184.333C183.998 185.087 183.742 185.721 183.232 186.235C182.722 186.748 182.089 187.004 181.333 187H168.667C170.089 189.8 172.167 192.056 174.901 193.768C177.636 195.48 180.668 196.335 184 196.333C185.556 196.333 187.078 196.144 188.568 195.765C190.058 195.387 191.446 194.82 192.733 194.067C193.533 193.578 194.4 193.378 195.333 193.467C196.267 193.556 197.044 193.911 197.667 194.533C198.289 195.156 198.589 195.911 198.568 196.8C198.547 197.689 198.157 198.378 197.4 198.867C195.444 200.156 193.356 201.167 191.133 201.901C188.911 202.636 186.533 203.002 184 203Z"/>
                    </svg>
                </div>
                <div class="tile-title">Charges / Salaires</div>
            </div>

            <div class="tile problem" data-tile="factures" data-section="2" style="grid-column: 2; grid-row: 6;">
                <div class="tile-icon">
                    <svg width="32" height="32" viewBox="0 0 240 240" fill="currentColor">
                        <path fill-rule="evenodd" d="M66 26C55 26 46.1 35 46.1 46L46 206C46 217 54.9 226 65.9 226H186C197 226 206 217 206 206V86L146 26H66ZM136 96V41L191 96H136Z M122.5 188.5C118.125 188.5 114.028 187.683 110.208 186.05C106.388 184.417 103.048 182.171 100.188 179.312C97.3268 176.454 95.081 173.114 93.45 169.292C91.819 165.47 91.0023 161.373 91 157C90.9977 152.627 91.8143 148.53 93.45 144.708C95.0857 140.886 97.3315 137.546 100.188 134.688C103.044 131.829 106.384 129.583 110.208 127.95C114.032 126.317 118.13 125.5 122.5 125.5C123.725 125.5 124.907 125.573 126.046 125.72C127.184 125.867 128.336 126.086 129.5 126.375V133.55C128.333 133.2 127.182 132.937 126.046 132.762C124.909 132.587 123.727 132.5 122.5 132.5C115.617 132.5 109.813 134.863 105.088 139.588C100.363 144.313 98 150.117 98 157C98 163.883 100.363 169.688 105.088 174.413C109.813 179.138 115.617 181.5 122.5 181.5C129.383 181.5 135.188 179.138 139.913 174.413C144.638 169.688 147 163.883 147 157C147 156.358 146.971 155.775 146.913 155.25C146.854 154.725 146.767 154.142 146.65 153.5H153.825C153.942 154.142 154 154.725 154 155.25V157C154 161.375 153.183 165.473 151.55 169.295C149.917 173.117 147.671 176.457 144.813 179.312C141.954 182.168 138.614 184.414 134.792 186.05C130.97 187.686 126.873 188.502 122.5 188.5ZM132.3 171.7L119 158.4V139.5H126V155.6L137.2 166.8L132.3 171.7ZM147 146.5V136H136.5V129H147V118.5H154V129H164.5V136H154V146.5H147Z"/>
                    </svg>
                </div>
                <div class="tile-title">Factures Clients</div>
            </div>

            <!-- PROBLÈMES (Section 3 - Croissance) -->
            <div class="tile problem" data-tile="doute" data-section="3" style="grid-column: 2; grid-row: 3;">
                <div class="tile-icon">
                    <svg width="32" height="32" viewBox="0 0 240 240" fill="currentColor">
                        <path d="M60 74V90C60 92.8333 59.04 95.21 57.12 97.13C55.2 99.05 52.8267 100.007 50 100C47.1733 99.9933 44.8 99.0333 42.88 97.12C40.96 95.2067 40 92.8333 40 90V50C40 47.1667 40.96 44.7933 42.88 42.88C44.8 40.9667 47.1733 40.0067 50 40H90C92.8333 40 95.21 40.96 97.13 42.88C99.05 44.8 100.007 47.1733 100 50C99.9933 52.8267 99.0333 55.2033 97.12 57.13C95.2067 59.0567 92.8333 60.0133 90 60H74L124.25 110.25C126.083 112.083 127.5 114.21 128.5 116.63C129.5 119.05 130 121.59 130 124.25V190C130 192.833 129.043 195.21 127.13 197.13C125.217 199.05 122.84 200.007 120 200C117.16 199.993 114.787 199.033 112.88 197.12C110.973 195.207 110.013 192.833 110 190V124L60 74ZM180 74L155.5 98.75C153.5 100.75 151.127 101.75 148.38 101.75C145.633 101.75 143.257 100.75 141.25 98.75C139.243 96.75 138.243 94.3333 138.25 91.5C138.257 88.6667 139.257 86.25 141.25 84.25L166 60H150C147.167 60 144.793 59.04 142.88 57.12C140.967 55.2 140.007 52.8267 140 50C139.993 47.1733 140.953 44.8 142.88 42.88C144.807 40.96 147.18 40 150 40H190C192.833 40 195.21 40.96 197.13 42.88C199.05 44.8 200.007 47.1733 200 50V90C200 92.8333 199.04 95.21 197.12 97.13C195.2 99.05 192.827 100.007 190 100C187.173 99.9933 184.8 99.0333 182.88 97.12C180.96 95.2067 180 92.8333 180 90V74Z"/>
                    </svg>
                </div>
                <div class="tile-title">Doute / Incertitude</div>
            </div>

            <div class="tile problem" data-tile="investissement" data-section="3" style="grid-column: 5; grid-row: 2;">
                <div class="tile-icon">
                    <svg width="32" height="32" viewBox="0 0 240 240" fill="currentColor">
                        <path d="M67.5 100H112.5C114.5 100 116.25 99.25 117.75 97.75C119.25 96.25 120 94.5 120 92.5C120 90.5 119.25 88.75 117.75 87.25C116.25 85.75 114.5 85 112.5 85H67.5C65.5 85 63.75 85.75 62.25 87.25C60.75 88.75 60 90.5 60 92.5C60 94.5 60.75 96.25 62.25 97.75C63.75 99.25 65.5 100 67.5 100ZM67.5 75H112.5C114.5 75 116.25 74.25 117.75 72.75C119.25 71.25 120 69.5 120 67.5C120 65.5 119.25 63.75 117.75 62.25C116.25 60.75 114.5 60 112.5 60H67.5C65.5 60 63.75 60.75 62.25 62.25C60.75 63.75 60 65.5 60 67.5C60 69.5 60.75 71.25 62.25 72.75C63.75 74.25 65.5 75 67.5 75ZM170 110V50H180C185.5 50 190.21 51.96 194.13 55.88C198.05 59.8 200.007 64.5067 200 70H220C222.833 70 225.21 70.96 227.13 72.88C229.05 74.8 230.007 77.1733 230 80C229.993 82.8267 229.033 85.2033 227.12 87.13C225.207 89.0567 222.833 90.0133 220 90H200C200 95.5 198.043 100.21 194.13 104.13C190.217 108.05 185.507 110.007 180 110H170ZM120 155H60V130C49 130 39.5833 126.083 31.75 118.25C23.9167 110.417 20 101 20 90V70C20 59 23.9167 49.5833 31.75 41.75C39.5833 33.9167 49 30 60 30H140C145.5 30 150.21 31.96 154.13 35.88C158.05 39.8 160.007 44.5067 160 50V110C160 115.5 158.043 120.21 154.13 124.13C150.217 128.05 145.507 130.007 140 130H120V155ZM55 210C50.8333 210 47.2933 208.543 44.38 205.63C41.4667 202.717 40.0067 199.173 40 195V180C40 175.833 41.46 172.293 44.38 169.38C47.3 166.467 50.84 165.007 55 165H125C129.167 165 132.71 166.46 135.63 169.38C138.55 172.3 140.007 175.84 140 180V195C140 199.167 138.543 202.71 135.63 205.63C132.717 208.55 129.173 210.007 125 210H55Z M159 166 C159 160.477 163.477 156 169 156 H 223 C 228.523 156 233 160.477 233 166 V 166 C 233 171.523 228.523 176 223 176 H 169 C 163.477 176 159 171.523 159 166 V 166 Z M186 193 C186 187.477 190.477 183 196 183 H 196 C 201.523 183 206 187.477 206 193 V 247 C 206 252.523 201.523 257 196 257 H 196 C 190.477 257 186 252.523 186 247 V 193 Z"/>
                    </svg>
                </div>
                <div class="tile-title">Investissement Matériel</div>
            </div>

            <div class="tile problem" data-tile="recrutement" data-section="3" style="grid-column: 1; grid-row: 5;">
                <div class="tile-icon">
                    <svg width="32" height="32" viewBox="0 0 241 241" fill="currentColor">
                        <path d="M125 130.5C129.833 125.167 133.543 119.083 136.13 112.25C138.717 105.417 140.007 98.3333 140 91C139.993 83.6667 138.703 76.5833 136.13 69.75C133.557 62.9167 129.847 56.8333 125 51.5C135 52.8333 143.333 57.25 150 64.75C156.667 72.25 160 81 160 91C160 101 156.667 109.75 150 117.25C143.333 124.75 135 129.167 125 130.5ZM180 211V181C180 175 178.667 169.29 176 163.87C173.333 158.45 169.833 153.66 165.5 149.5C174 152.5 181.877 156.377 189.13 161.13C196.383 165.883 200.007 172.507 200 181V211H180ZM80 131C69 131 59.5833 127.083 51.75 119.25C43.9167 111.417 40 102 40 91C40 80 43.9167 70.5833 51.75 62.75C59.5833 54.9167 69 51 80 51C91 51 100.417 54.9167 108.25 62.75C116.083 70.5833 120 80 120 91C120 102 116.083 111.417 108.25 119.25C100.417 127.083 91 131 80 131ZM0 211V183C0 177.333 1.46 172.127 4.38 167.38C7.3 162.633 11.1733 159.007 16 156.5C26.3333 151.333 36.8333 147.46 47.5 144.88C58.1667 142.3 69 141.007 80 141C91 140.993 101.833 142.287 112.5 144.88C123.167 147.473 133.667 151.347 144 156.5C148.833 159 152.71 162.627 155.63 167.38C158.55 172.133 160.007 177.34 160 183V211H0Z M163 51C163 45.4772 167.477 41 173 41H227C232.523 41 237 45.4772 237 51V51C237 56.5228 232.523 61 227 61H173C167.477 61 163 56.5228 163 51V51Z M190 78C190 72.4772 194.477 68 200 68H200C205.523 68 210 72.4772 210 78V132C210 137.523 205.523 142 200 142H200C194.477 142 190 137.523 190 132V78Z"/>
                    </svg>
                </div>
                <div class="tile-title">Recrutement</div>
            </div>

            <!-- SOLUTIONS (Centre) -->
            <div class="tile solution" data-tile="marge" data-section="1" style="grid-column: 3; grid-row: 3;">
                <div class="tile-icon">
                    <svg width="32" height="32" viewBox="0 0 300 300" fill="currentColor">
                        <path d="M21.875 167.5C19.1667 165.625 17.5542 163.075 17.0375 159.85C16.5208 156.625 17.0917 153.55 18.75 150.625L56.875 89.375C61.4583 82.0833 67.9708 78.1791 76.4125 77.6625C84.8542 77.1458 91.7792 80.1125 97.1875 86.5625L112.5 104.375L142.187 56.25C146.979 48.3333 153.908 44.325 162.975 44.225C172.042 44.125 179.071 47.925 184.062 55.625L200 79.375L235 23.75C236.875 20.625 239.637 18.7 243.287 17.975C246.937 17.25 250.217 18.0291 253.125 20.3125C255.833 22.1875 257.45 24.7416 257.975 27.975C258.5 31.2083 257.925 34.2791 256.25 37.1875L221.25 92.8125C216.458 100.521 209.533 104.375 200.475 104.375C191.417 104.375 184.383 100.625 179.375 93.125L163.437 69.375L133.75 117.5C129.375 124.792 122.971 128.75 114.537 129.375C106.104 130 99.175 127.083 93.75 120.625L78.125 102.5L40 164.062C38.125 167.187 35.3625 169.117 31.7125 169.85C28.0625 170.583 24.7833 169.8 21.875 167.5ZM181.25 225C190 225 197.396 221.979 203.437 215.937C209.479 209.896 212.5 202.5 212.5 193.75C212.5 185 209.479 177.604 203.437 171.562C197.396 165.521 190 162.5 181.25 162.5C172.5 162.5 165.104 165.521 159.062 171.562C153.021 177.604 150 185 150 193.75C150 202.5 153.021 209.896 159.062 215.937C165.104 221.979 172.5 225 181.25 225ZM181.25 250C165.625 250 152.342 244.533 141.4 233.6C130.458 222.667 124.992 209.383 125 193.75C125.008 178.117 130.479 164.837 141.412 153.912C152.346 142.987 165.625 137.517 181.25 137.5C196.875 137.483 210.158 142.954 221.1 153.912C232.042 164.871 237.508 178.15 237.5 193.75C237.5 199.167 236.771 204.429 235.312 209.537C233.854 214.646 231.667 219.383 228.75 223.75L253.75 248.75C256.042 251.042 257.187 253.958 257.187 257.5C257.187 261.042 256.042 263.958 253.75 266.25C251.458 268.542 248.542 269.687 245 269.687C241.458 269.687 238.542 268.542 236.25 266.25L211.25 241.25C206.875 244.167 202.137 246.354 197.037 247.812C191.937 249.271 186.675 250 181.25 250Z"/>
                    </svg>
                </div>
                <div class="tile-title">Marge par Chantier</div>
            </div>

            <div class="tile solution" data-tile="previsionnel" data-section="2" style="grid-column: 4; grid-row: 5;">
                <div class="tile-icon">
                    <svg width="32" height="32" viewBox="0 0 240 240" fill="currentColor">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M12 154C14.5 150.5 23.5 122 29 121C34.5 120 44.5 154 48 154C51.5 154 61.5 121 65 121C68.5 121 74.5 153 78 154C81.5 155 97 118 102 121C107 124 105.5 152.5 110 154C114.5 155.5 123.5 122 128 121C132.5 120 140 151 146 154C152 157 221 89 221 89L219 80C219 80 152 148 145.5 145C139.5 142.5 131 113 127 112C123 111 114.5 143.5 110.5 145C106.5 146.5 108 116 102.5 112C97 108 81 145.5 78 145C75 144.5 68 112 65 112C62 112 52.5 145 48 145C43.5 145 34 112 29 112C24 112 14 141.5 12 145L4 145L12 154Z"/>
                    </svg>
                </div>
                <div class="tile-title">Prévisionnel de Trésorerie</div>
            </div>

            <div class="tile solution" data-tile="conseil" data-section="3" style="grid-column: 3; grid-row: 5;">
                <div class="tile-icon">
                    <svg width="32" height="32" viewBox="0 0 241 240" fill="currentColor">
                        <path fill-rule="evenodd" d="M20 220V40C20 34.5 21.96 29.7933 25.88 25.88C29.8 21.9667 34.5067 20.0067 40 20H200C205.5 20 210.21 21.96 214.13 25.88C218.05 29.8 220.007 34.5067 220 40V160C220 165.5 218.043 170.21 214.13 174.13C210.217 178.05 205.507 180.007 200 180H60L20 220ZM81.875 153.25V131.75C81.875 129.69 82.4125 127.832 83.4875 126.176C84.5625 124.521 85.9958 123.198 87.7875 122.209L114.125 108.906V99.5L95.4469 108.772C94.3719 109.309 93.2521 109.712 92.0875 109.981C90.9229 110.25 89.7583 110.384 88.5938 110.384C85.8167 110.384 83.1955 109.668 80.7301 108.234C78.2648 106.801 76.3621 104.741 75.0219 102.053C73.7677 99.6344 73.2302 97.0598 73.4094 94.3293C73.5886 91.5988 74.4396 89.0671 75.9625 86.7344L92.625 61.875L81.875 45.75H114.125C126.04 45.75 136.186 49.9156 144.564 58.2469C152.941 66.5781 157.129 76.7458 157.125 88.75V153.25H81.875ZM92.625 142.5H146.375V88.75C146.375 79.7917 143.24 72.1771 136.969 65.9062C130.698 59.6354 123.083 56.5 114.125 56.5H102.031L105.525 61.875L84.9656 92.7812C84.5177 93.4979 84.2723 94.2379 84.2293 95.0011C84.1863 95.7644 84.3421 96.5025 84.6969 97.2156C85.1448 98.201 85.7504 98.8514 86.5136 99.1667C87.2769 99.4821 88.0151 99.638 88.7281 99.6344C88.9969 99.6344 89.6688 99.5 90.7438 99.2312L124.875 82.0312V115.625L92.625 131.75V142.5Z"/>
                    </svg>
                </div>
                <div class="tile-title">Conseil Stratégique</div>
            </div>

            <!-- BÉNÉFICES (Droite) -->
            <div class="tile benefit" data-tile="decisions" data-section="1" style="grid-column: 6; grid-row: 4;">
                <div class="tile-icon">
                    <svg width="32" height="32" viewBox="0 0 234 234" fill="currentColor">
                        <path d="M130 30C92.3 30 61.9 59.5 60 96.6L40.8 121.9C38.4 125 40.8 130 45 130H60V160C60 171.1 68.9 180 80 180H90V210H160V163.1C183.7 151.9 200 128 200 100C200 61.4 168.8 30 130 30ZM140 140H120V130H140V140ZM156 95C153.337 99.4967 149.545 103.22 145 105.8V120H115V105.8C100.7 97.5 95.7 79.2 104 65C112.3 50.8 130.7 45.6 145 53.8C159.3 62 164.3 80.5 156 95Z"/>
                    </svg>
                </div>
                <div class="tile-title">Décisions Éclairées</div>
            </div>

            <div class="tile benefit" data-tile="serenite" data-section="2" style="grid-column: 6; grid-row: 3;">
                <div class="tile-icon">
                    <svg width="32" height="32" viewBox="0 0 240 234" fill="currentColor">
                        <path d="M233.719 112.153C232.512 110.039 230.896 108.187 228.964 106.706C227.032 105.225 224.824 104.144 222.469 103.528C216.84 102.068 211.053 101.303 205.238 101.25C207.35 88.0838 206.387 74.6074 202.425 61.875C200.997 57.4033 197.956 53.6232 193.894 51.2713C189.831 48.9195 185.039 48.1644 180.45 49.1532C171.802 51.0616 163.516 54.3438 155.906 58.875C149.788 47.6382 141.39 37.8032 131.25 30C128 27.5759 124.054 26.2664 120 26.2664C115.946 26.2664 112 27.5759 108.75 30C98.6103 37.8032 90.2123 47.6382 84.0938 58.875C76.4938 54.3433 68.2171 51.058 59.5781 49.1438C54.9881 48.1555 50.1946 48.9119 46.132 51.2656C42.0694 53.6193 39.0288 57.4015 37.6031 61.875C33.641 74.6074 32.6784 88.0838 34.7906 101.25C28.966 101.301 23.1696 102.066 17.5313 103.528C15.1763 104.144 12.9681 105.225 11.0362 106.706C9.10437 108.187 7.48777 110.039 6.28126 112.153C5.0332 114.302 4.22473 116.677 3.90284 119.141C3.58095 121.606 3.75208 124.109 4.40626 126.506C7.73439 138.844 17.9063 162.281 48.6 180.619C78.9 198.75 105.713 198.75 120.075 198.75C134.438 198.75 161.1 198.75 191.391 180.619C222.084 162.281 232.256 138.844 235.584 126.506C236.24 124.11 236.413 121.606 236.092 119.142C235.772 116.678 234.965 114.303 233.719 112.153ZM60.15 161.297C39.2531 148.809 30.7594 133.988 27.3375 124.406C31.8447 123.686 36.4251 123.541 40.9688 123.975C43.2312 129.692 45.9103 135.235 48.9844 140.559C54.1358 149.464 60.2985 157.744 67.35 165.234C64.9688 164.063 62.5688 162.75 60.15 161.297ZM74.0625 138.066C72.0938 135.253 70.2 132.441 68.4375 129.356C53.7844 103.781 55.1625 83.3813 58.125 71.9625C64.2722 73.767 70.1173 76.4747 75.4688 79.9969C72.609 90.3273 71.1893 101.003 71.25 111.722C71.2092 120.58 72.1525 129.416 74.0625 138.066ZM120 173.691C110.888 166.125 93.75 147.178 93.75 111.694C93.75 76.6125 110.625 57.6 120 49.7438C129.375 57.6 146.25 76.6125 146.25 111.694C146.25 147.188 129.113 166.153 120 173.719V173.691ZM165.938 138.066C167.848 129.416 168.791 120.58 168.75 111.722C168.811 101.003 167.391 90.3273 164.531 79.9969C169.882 76.4714 175.727 73.7606 181.875 71.9532C184.809 83.3813 186.188 103.828 171.506 129.356C169.781 132.403 167.888 135.3 165.938 138.066ZM179.869 161.297C177.469 162.731 175.097 164.025 172.763 165.197C179.785 157.714 185.923 149.447 191.053 140.559C194.127 135.235 196.806 129.692 199.069 123.975C203.612 123.541 208.193 123.686 212.7 124.406C209.241 133.988 200.747 148.809 179.85 161.297H179.869Z"/>
                    </svg>
                </div>
                <div class="tile-title">Sérénité / Anticipation</div>
            </div>

            <div class="tile benefit" data-tile="croissance" data-section="3" style="grid-column: 6; grid-row: 6;">
                <div class="tile-icon">
                    <svg width="32" height="32" viewBox="0 0 240 240" fill="currentColor">
                        <path fill-rule="evenodd" d="M120 220C96.8333 214.167 77.7067 200.873 62.62 180.12C47.5333 159.367 39.9933 136.327 40 111V50L120 20L200 50V111C200 136.333 192.46 159.377 177.38 180.13C162.3 200.883 143.173 214.173 120 220ZM77.4874 154.442C75.5222 156.382 75.5018 159.548 77.4418 161.513C79.3817 163.478 82.5475 163.498 84.5127 161.558L81 158L84.5127 161.558C103.971 142.35 123.687 123.632 138.544 109.711C145.971 102.752 152.18 96.9952 156.532 92.9789C158.708 90.9709 160.419 89.3981 161.585 88.328C162.168 87.793 162.615 87.3837 162.916 87.1084C163.067 86.9708 163.181 86.8667 163.257 86.7972C163.295 86.7624 163.323 86.7363 163.342 86.719C163.352 86.7103 163.359 86.7038 163.364 86.6996C163.366 86.6974 163.368 86.6959 163.369 86.6948C163.369 86.6943 163.37 86.694 163.37 86.6937C163.37 86.6935 163.37 86.6934 160 83C156.63 79.3066 156.63 79.3068 156.629 79.3071C156.629 79.3074 156.628 79.3079 156.628 79.3085C156.626 79.3097 156.624 79.3114 156.622 79.3137C156.617 79.3184 156.609 79.3252 156.6 79.3342C156.58 79.3523 156.55 79.3791 156.512 79.4146C156.434 79.4855 156.318 79.5911 156.166 79.7302C155.862 80.0084 155.412 80.4208 154.825 80.959C153.652 82.0355 151.933 83.615 149.75 85.6304C145.382 89.661 139.154 95.4353 131.706 102.414C116.813 116.368 97.0292 135.15 77.4874 154.442L81 158Z M164.995 83.2285C165.121 80.47 162.987 78.1314 160.229 78.0052L115.276 75.9485C112.517 75.8223 110.179 77.9562 110.052 80.7147C109.926 83.4733 112.06 85.8118 114.819 85.938L154.777 87.7662L152.949 127.724C152.822 130.483 154.956 132.822 157.715 132.948C160.473 133.074 162.812 130.94 162.938 128.181L164.995 83.2285Z"/>
                    </svg>
                </div>
                <div class="tile-title">Croissance Sereine</div>
            </div>

            <!-- SVG sera créé automatiquement par JavaScript -->
        </div>
    </section>
</div>
</div>

<!-- CSS optimisé -->
<style>
#stratego-final-map {
    --dark-blue: #0B2957;
    --gold: #BF9B30;
    --light-blue: #3a8eff;
    --dark-gray: #4A4A4A;
    --light-gray: #f8f9fa;
    --inactive-gray: #d1d5db;
    --white: #ffffff;
    --shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
    --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
    
    font-family: 'Raleway', sans-serif !important;
    line-height: 1.6;
    color: var(--dark-gray);
    position: relative;
    z-index: 1;
    background: transparent;
}

#stratego-final-map *,
#stratego-final-map *::before,
#stratego-final-map *::after {
    box-sizing: border-box;
}

#stratego-final-map .stratego-container {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 20px 20px 20px;
}

#stratego-final-map .main-section {
    display: grid !important;
    grid-template-columns: 1fr 1fr !important;
    gap: 60px !important;
    align-items: start;
    margin-bottom: 120px;
}

#stratego-final-map .section-content {
    width: 100% !important;
    padding-right: 0 !important;
    padding-bottom: 40px;
}

#stratego-final-map .content-block {
    opacity: 1;
    visibility: visible;
    transition: all 0.6s ease;
    margin-bottom: 80px;
    padding: 40px 0 120px 0; /* Plus de padding en bas */
    min-height: 800px; /* Hauteur minimale pour scroll observer */
}

#stratego-final-map .content-block:first-child {
    padding-top: 0;
}

#stratego-final-map .content-block h2 {
    font-family: 'Space Grotesk', sans-serif !important;
    font-weight: 700 !important;
    font-size: 2.5rem !important;
    line-height: 1.2 !important;
    color: var(--dark-blue) !important;
    margin-bottom: 20px !important;
}

#stratego-final-map .content-block h2 .highlight {
    color: var(--gold) !important;
}

#stratego-final-map .section-description {
    font-size: 1.1rem !important;
    line-height: 1.7 !important;
    color: var(--dark-gray) !important;
    margin-bottom: 30px !important;
}

#stratego-final-map .challenges {
    display: flex !important;
    flex-direction: column !important;
    gap: 18px !important;
}

#stratego-final-map .challenge {
    background: var(--light-gray) !important;
    border-radius: 12px !important;
    padding: 16px !important;
    border-left: 4px solid var(--gold) !important;
    transition: all 0.3s ease !important;
}

#stratego-final-map .challenge:hover {
    transform: translateY(-2px) !important;
    box-shadow: var(--shadow) !important;
}

#stratego-final-map .challenge h3 {
    font-family: 'Raleway', sans-serif !important;
    font-weight: 700 !important;
    font-size: 1.1rem !important;
    color: var(--dark-blue) !important;
    margin-bottom: 8px !important;
}

#stratego-final-map .challenge p {
    font-size: 0.95rem !important;
    line-height: 1.6 !important;
    color: var(--dark-gray) !important;
    margin: 0 !important;
}

/* CARTE INTERACTIVE UNIQUE */
#stratego-final-map .single-interactive-map {
    position: sticky !important;
    top: 138px !important;
    margin-left: 40px !important;
    width: 650px !important;
    height: 623px !important;
    background: var(--white) !important;
    border-radius: 20px !important;
    box-shadow: var(--shadow-lg) !important;
    padding: 13px !important;
    display: grid !important;
    grid-template-columns: repeat(6, 1fr) !important;
    grid-template-rows: repeat(6, 1fr) !important;
    gap: 5.5px !important;
    overflow: hidden !important;
}

/* PROTECTION CONTRE LES ANIMATIONS CSS EXTERNES */
#stratego-final-map .tile {
    animation: none !important;
    transform: none !important;
    transition: opacity 0.3s ease !important;
}

/* Protection du SVG contre les animations externes */
#stratego-final-map .connections-svg {
    animation: none !important;
    transform: none !important;
}

/* TUILES - État par défaut (blanches avec bordure grise) */
#stratego-final-map .tile {
    background: var(--white) !important;
    border: 1px solid #e6e6e6 !important;
    border-radius: 20px !important;
    width: 78px !important;
    height: 78px !important;
    padding: 8px !important;
    display: flex !important;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1) !important;
    cursor: pointer;
    position: relative;
    z-index: 2;
    opacity: 0.9;
}

/* Tuiles inactives : icône parfaitement centrée */
#stratego-final-map .tile:not(.active) .tile-icon {
    position: absolute !important;
    top: 50% !important;
    left: 50% !important;
    transform: translate(-50%, -50%) !important;
    z-index: 10 !important;
}

#stratego-final-map .tile:not(.active) .tile-title {
    opacity: 0 !important;
    visibility: hidden !important;
    position: absolute !important;
    z-index: 1 !important;
}



#stratego-final-map .tile-icon {
    width: 48px !important;
    height: 48px !important;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
    color: var(--inactive-gray);
}

#stratego-final-map .tile-icon svg {
    width: 100% !important;
    height: 100% !important;
    transition: all 0.4s ease;
    object-fit: contain;
}

#stratego-final-map .tile-title {
    font-weight: 600 !important;
    font-size: 0.55rem !important;
    color: inherit;
    opacity: 0;
    transition: all 0.3s ease;
    text-align: center;
    line-height: 1.2;
    margin-top: auto;
}

/* TUILES ACTIVES */
#stratego-final-map .tile.active {
    background: var(--white) !important;
    border-color: var(--light-blue) !important;
    border-width: 1.5px !important;
    color: var(--dark-blue) !important;
    box-shadow: 0 12px 32px rgba(58, 143, 255, 0.25) !important;
    opacity: 1 !important;
    transform: translateY(-4px) !important;
    justify-content: space-between !important;
}

#stratego-final-map .tile.active .tile-icon {
    color: inherit;
    opacity: 1;
    width: 32px !important;
    height: 32px !important;
    position: relative !important;
    top: auto !important;
    left: auto !important;
    transform: none !important;
}

#stratego-final-map .tile.active .tile-title {
    opacity: 1;
}

/* Styles spécifiques par type */
#stratego-final-map .tile.active.problem {
    border-color: var(--gold) !important;
    border-width: 1.5px !important;
    box-shadow: 0 12px 32px rgba(191, 155, 48, 0.25) !important;
}

#stratego-final-map .tile.active.problem .tile-icon {
    color: var(--gold) !important;
}

#stratego-final-map .tile.active.solution {
    border-color: var(--light-blue) !important;
    border-width: 1.5px !important;
    background: linear-gradient(135deg, var(--light-blue) 0%, #60a5fa 100%) !important;
    box-shadow: 0 16px 40px rgba(58, 143, 255, 0.4) !important;
}

#stratego-final-map .tile.active.solution .tile-icon {
    color: var(--white) !important;
}

#stratego-final-map .tile.active.solution .tile-title {
    color: var(--white) !important;
}

#stratego-final-map .tile.active.benefit {
    border-color: var(--light-blue) !important;
    background: linear-gradient(135deg, var(--light-blue) 0%, #2563eb 100%) !important;
}

#stratego-final-map .tile.active.benefit .tile-icon {
    color: var(--white) !important;
}

#stratego-final-map .tile.active.benefit .tile-title {
    color: var(--white) !important;
}

#stratego-final-map .tile:hover {
    transform: translateY(-2px) !important;
    box-shadow: var(--shadow) !important;
}

/* ANIMATIONS DES TUILES */
#stratego-final-map .tile.pulse {
    animation: pulse 2s infinite !important;
}

#stratego-final-map .tile.glow {
    box-shadow: 0 0 20px var(--gold) !important;
}

@keyframes pulse {
    0%, 100% { transform: scale(1.02); }
    50% { transform: scale(1.08); }
}

@keyframes fadeIn {
    from { opacity: 0; transform: scale(0.8); }
    to { opacity: 1; transform: scale(1.02); }
}

/* CONNEXIONS SVG */
#stratego-final-map .connections {
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
    pointer-events: none !important;
    z-index: 1 !important;
}

/* FIX SVG ET CONNEXIONS */
#stratego-final-map {
    position: relative !important;
}

#stratego-final-map svg {
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
    z-index: 5 !important;
    pointer-events: none !important;
}

/* ===============================================
   CONNEXIONS SVG - SÉLECTEURS TRÈS SPÉCIFIQUES
   =============================================== */

/* SVG container pour les connexions */
#stratego-final-map .connections-svg {
    position: absolute !important;
    top: 0 !important;
    left: 0 !important;
    width: 100% !important;
    height: 100% !important;
    z-index: 999 !important;
    pointer-events: none !important;
    overflow: visible !important;
}

/* Styles pour les paths de connexions (très spécifique pour éviter conflit avec icônes) */
#stratego-final-map .connections-svg .connection-path {
    fill: none !important;
    stroke: #bf9b30 !important;
    stroke-width: 2px !important;
    opacity: 0 !important;
    transition: opacity 0.3s ease !important;
}



/* RESPONSIVE */
@media (max-width: 1024px) {
    #stratego-final-map .main-section {
        grid-template-columns: 1fr !important;
        gap: 40px !important;
    }
    
    #stratego-final-map .content-block {
        margin-bottom: 60px;
        min-height: 60vh !important;
    }
    
    #stratego-final-map .single-interactive-map {
        position: relative !important;
        top: auto !important;
        height: 60vh !important;
        min-height: 400px !important;
        padding: 20px !important;
        grid-template-columns: repeat(6, 1fr) !important;
        margin: 20px 0 !important;
    }
    
    #stratego-final-map .content-block h2 {
        font-size: 2rem !important;
    }
}

@media (max-width: 768px) {
    #stratego-final-map .single-interactive-map {
        height: 400px !important;
        grid-template-columns: repeat(4, 1fr) !important;
        grid-template-rows: repeat(8, 1fr) !important;
    }
    
    #stratego-final-map .tile {
        min-height: 60px !important;
        max-height: 60px !important;
    }
    
    #stratego-final-map .tile-title {
        font-size: 0.6rem !important;
    }
}
</style>

<!-- JavaScript pour l'interactivité -->
<script>
(function() {
    'use strict';
    
    class FinalMapController {
        constructor() {
            this.currentSection = 1;
            this.animationInterval = null;
            this.isAnimating = false;
            this.scrollObserver = null;
            this.currentAnimationId = null; // ID unique pour suivre l'animation active
            // this.lastAnimatedSection supprimé car causait des blocages d'animation
        }
        
        init() {
            console.log('🚀 Initialisation de Stratégo Map');
            
            this.bindEvents();
            this.setupScrollObserver();
            
            // Protection contre CSS externe d'abord
            this.protectAgainstExternalCSS(); 
            
            // CRÉATION AUTOMATIQUE : toutes les connexions après chargement
            // Attendre que la page soit complètement chargée et rendue
            const initConnections = () => {
                const container = document.querySelector('#stratego-final-map .single-interactive-map');
                if (container && container.getBoundingClientRect().width > 0) {
                    console.log('🔧 Container prêt, création des connexions...');
                    this.createAllConnections();
                } else {
                    console.log('⏸️ Container pas encore prêt, nouvelle tentative...');
                    setTimeout(initConnections, 500);
                }
            };
            
            setTimeout(initConnections, 1000);
            
            // AUCUNE animation au chargement - elle se lancera au scroll
            console.log('🎬 Initialisation simple - En attente du scroll utilisateur');
            this.currentSection = null; // Aucune section active au départ
            this.isAnimating = false;
        }
        
        setupScrollObserver() {
            console.log('🔍 Configuration du scroll listener simple');
            
            let lastTriggerTime = 0;
            
            const handleScroll = () => {
                const now = Date.now();
                
                // Debounce
                if (now - lastTriggerTime < 500) return;
                
                // Calculer quelle section est visible
                const blocks = document.querySelectorAll('#stratego-final-map .content-block');
                const viewportHeight = window.innerHeight;
                const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
                
                let activeSection = 1; // Par défaut section 1
                
                blocks.forEach(block => {
                    const rect = block.getBoundingClientRect();
                    const blockTop = rect.top + scrollTop;
                    const blockHeight = rect.height;
                    const blockCenter = blockTop + (blockHeight / 2);
                    const viewportCenter = scrollTop + (viewportHeight / 2);
                    const sectionNumber = parseInt(block.dataset.content);
                    
                    // Logique différente pour Section 3 (très permissive)
                    let isActive = false;
                    if (sectionNumber === 3) {
                        // Pour section 3 : se déclenche dès que le titre commence à apparaître
                        isActive = rect.top < viewportHeight * 0.9 && rect.bottom > 0;
                        if (isActive) {
                            console.log(`🔍 Section 3 détectée très tôt (top: ${rect.top}px, seuil: ${viewportHeight * 0.9}px)`);
                        }
                    } else if (sectionNumber === 1) {
                        // Pour section 1 : détection plus tardive pour laisser le temps de voir l'animation
                        isActive = Math.abs(blockCenter - viewportCenter) < viewportHeight / 4; // Plus restrictif
                        if (isActive) {
                            console.log(`🔍 Section 1 détectée (distance: ${Math.abs(blockCenter - viewportCenter)}px, seuil restrictif)`);
                        }
                    } else if (sectionNumber === 2) {
                        // Pour section 2 : détection plus précoce (seuil élargi)
                        isActive = Math.abs(blockCenter - viewportCenter) < viewportHeight / 2.2; // Plus permissif
                        if (isActive) {
                            console.log(`🔍 Section 2 détectée plus tôt (distance: ${Math.abs(blockCenter - viewportCenter)}px, seuil élargi)`);
                        }
                    } else {
                        // Pour les autres sections : logique normale
                        isActive = Math.abs(blockCenter - viewportCenter) < viewportHeight / 3;
                        if (isActive) {
                            console.log(`🔍 Section ${sectionNumber} détectée au centre (distance: ${Math.abs(blockCenter - viewportCenter)}px)`);
                        }
                    }
                    
                    if (isActive && sectionNumber) {
                        activeSection = sectionNumber;
                    }
                });
                
                // Changer de section SEULEMENT si pas en cours d'animation
                if (activeSection !== this.currentSection && !this.isAnimating) {
                    // Pour le premier scroll (currentSection = null), pas de délai
                    if (this.currentSection !== null) {
                        // Délai simple pour éviter les changements trop rapides
                        const now = Date.now();
                        if (now - lastTriggerTime < 1500) { // 1.5 seconde pour plus de stabilité
                            console.log(`⏰ Changement trop rapide ignoré: ${this.currentSection} → ${activeSection}`);
                            return;
                        }
                        lastTriggerTime = now;
                    }
                    
                    console.log(`✅ Changement de section: ${this.currentSection} → ${activeSection}`);
                    
                    // Pour la Section 1, petit délai pour qu'elle soit bien visible
                    if (activeSection === 1 && this.currentSection === null) {
                        console.log('⏰ Délai spécial pour Section 1 - attendre qu\'elle soit bien visible');
                        setTimeout(() => {
                            if (!this.isAnimating) { // Vérifier qu'il n'y a pas eu d'autre changement
                                this.switchToSection(activeSection);
                            }
                        }, 800);
                    } else {
                        this.switchToSection(activeSection);
                    }
                }
            };
            
            // Écouter le scroll simple (kill switch géré dans switchToSection)
            window.addEventListener('scroll', handleScroll, { passive: true });
            
            // Test initial
            setTimeout(() => {
                handleScroll();
            }, 1000);
            
            console.log('✅ Scroll listener configuré');
            
            // Recalculer les connexions au redimensionnement
            window.addEventListener('resize', () => {
                setTimeout(() => {
                    this.recalculateConnectionPositions();
                }, 250);
            });
        }
        
        switchToSection(sectionNumber) {
            console.log('🎯 Switching to section:', sectionNumber); // Debug activé
            
            // Arrêter l'animation précédente ET stopper l'animation en cours
            if (this.animationInterval) {
                clearInterval(this.animationInterval);
                this.animationInterval = null;
            }
            
            // CRUCIAL : Stopper l'animation en cours (système ID unique)
            if (this.currentAnimationId) {
                console.log('🛑 KILL SWITCH: Changement de section, stop animation en cours');
            }
            this.stopCurrentAnimation();
            
            this.currentSection = sectionNumber;
            
            // Plus besoin de lastAnimatedSection - supprimé car causait des blocages
            
            // Reset complet et démarrage propre
            this.resetAllTiles();
            
            // Démarrer immédiatement la première animation
            this.runSingleAnimation(sectionNumber);
            
            // RÉPÉTITION AUTOMATIQUE AVEC RESET
            this.animationInterval = setInterval(() => {
                if (!this.isAnimating && document.visibilityState === 'visible' && this.currentSection === sectionNumber) {
                    console.log(`🔄 Répétition automatique - Section ${sectionNumber}`);
                    // Reset TOUTES les tuiles de la section courante avant répétition
                    this.resetCurrentSectionTiles(sectionNumber);
                    setTimeout(() => {
                        // ✅ VÉRIFICATION CRITIQUE : On est toujours dans la même section ?
                        if (this.currentSection === sectionNumber && !this.isAnimating) {
                            console.log(`🎯 Lancement répétition section ${sectionNumber} (vérifiée)`);
                            this.runSingleAnimation(sectionNumber);
                        } else {
                            console.log(`🚫 Répétition annulée - section changée (${this.currentSection} ≠ ${sectionNumber})`);
                        }
                    }, 300); // Petit délai après reset
                }
            }, 12000); // 12 secondes
            
            console.log(`🔄 Animation en boucle activée pour Section ${sectionNumber} (toutes les 12s)`);
        }
        
        runSingleAnimation(sectionNumber) {
            console.log('🎭 runSingleAnimation appelé pour section:', sectionNumber);
            
            if (this.isAnimating) {
                console.log('⏸️ Animation already running, skipping');
                return;
            }
            
            // NOUVEAU : Créer un ID unique pour cette animation
            const animationId = this.createAnimationId();
            this.currentAnimationId = animationId;
            console.log('🆔 Nouvelle animation démarrée avec ID:', animationId.toString());
            
            this.isAnimating = true;
            // this.lastAnimatedSection supprimé car causait des blocages
            
            // Reset COMPLET de toutes les tuiles et connexions
            this.resetAllTiles();
            
            // Masquer les autres sections, la section active sera gérée par l'animation séquentielle
            document.querySelectorAll('#stratego-final-map .tile').forEach(tile => {
                const tileSection = tile.dataset.section;
                if (parseInt(tileSection) !== sectionNumber) {
                    tile.style.opacity = '0.3';
                    tile.classList.remove('active');
                }
                // Ne pas toucher à l'opacité de la section active - laissons l'animation le faire
            });
            
            // ✅ Sécurisation du lancement différé
            setTimeout(() => {
                if (!this.isAnimationActive(animationId)) {
                    console.log("⛔ Annulé : animationId non valide (animation tuée avant lancement)");
                    return;
                }

                this.recalculateConnectionPositions();

                if (sectionNumber === 1) {
                    this.animateSection1(animationId);
                } else if (sectionNumber === 2) {
                    this.animateSection2(animationId);
                } else if (sectionNumber === 3) {
                    this.animateSection3(animationId);
                }
            }, 200);

            // ✅ Sécurisation du déblocage
            setTimeout(() => {
                if (!this.isAnimationActive(animationId)) {
                    console.log("⛔ Annulé : déblocage ignoré (animationId plus actif)");
                    return;
                }

                this.isAnimating = false;
                console.log("✅ Animation terminée pour", sectionNumber);
            }, 6000);
        }
        
        resetAllTiles() {
            console.log('🔄 resetAllTiles() appelé - Stack trace:');
            console.trace();
            
            // Reset SIMPLE - ne jamais supprimer 'active' de la section courante
            document.querySelectorAll('#stratego-final-map .tile').forEach(tile => {
                const tileSection = parseInt(tile.dataset.section);
                
                // Supprimer animations pour toutes les tuiles
                tile.classList.remove('pulse', 'glow');
                tile.style.animation = '';
                
                if (tileSection !== this.currentSection) {
                    // Seulement masquer les autres sections
                    tile.classList.remove('active');
                    tile.style.opacity = '0.3';
                    console.log(`  ❌ Désactivation tuile ${tile.dataset.tile} (section ${tileSection})`);
                } else {
                    // Garder la section courante visible SANS toucher 'active'
                    tile.style.opacity = '1';
                    console.log(`  ✅ Préservation tuile ${tile.dataset.tile} (section ${tileSection})`);
                }
            });
            
            // Reset complet des connexions avec animation
            document.querySelectorAll('#stratego-final-map .auto-connection').forEach(path => {
                path.style.opacity = '0';
                path.style.transition = 'none'; // Pas d'animation pendant reset
                
                // Reset de l'animation de tracé
                try {
                    const pathLength = path.getTotalLength();
                    path.style.strokeDasharray = pathLength;
                    path.style.strokeDashoffset = pathLength; // Ligne invisible
                } catch (error) {
                    // Au cas où getTotalLength() échoue
                    console.warn('Erreur getTotalLength pour path:', path.id);
                }
            });
        }
        
        showConnectionsWithDelay(connectionIds, animationId, delayBetween = 200) {
            console.log(`🔍 showConnectionsWithDelay appelé avec:`, connectionIds);
            connectionIds.forEach((id, index) => {
                this.setAnimationTimeout(() => {
                    if (!this.isAnimationActive(animationId)) {
                        console.log('🚫 Connexion annulée (ancienne animation)');
                        return;
                    }
                    this.showConnections([id], animationId);
                }, index * delayBetween, animationId);
            });
        }
        
        showConnections(connectionIds, animationId) {
            console.log(`🔍 showConnections appelé avec:`, connectionIds);
            
            // Vérifier que le SVG principal existe
            const mainSvg = document.querySelector('#stratego-final-map .connections-svg');
            if (!mainSvg) {
                console.error('❌ SVG principal manquant - Recréation automatique');
                this.createAllConnections();
                return;
            }
            
            connectionIds.forEach(id => {
                // ✅ Sélection optimisée par ID unique
                const connectionId = `connection-${id}`;
                let path = document.getElementById(connectionId);
                
                // 🔧 Si la connexion n'existe pas, la recréer automatiquement
                if (!path) {
                    console.log(`🔧 Connexion ${id} manquante, recréation...`);
                    const [fromTile, toTile] = id.split('-');
                    
                    if (fromTile && toTile) {
                        this.createSingleConnection(mainSvg, fromTile, toTile, '#bf9b30', '3');
                        path = document.getElementById(connectionId);
                        
                        if (path) {
                            console.log(`✅ Connexion ${id} recréée avec succès`);
                        } else {
                            console.error(`❌ Échec de recréation de ${id}`);
                            return;
                        }
                    } else {
                        console.error(`❌ Format ID invalide: ${id}`);
                        return;
                    }
                }
                
                console.log(`🔍 Recherche connexion ID: ${connectionId}, trouvé:`, !!path);
                
                if (path && path.parentNode) {
                    try {
                        // 1. RESET obligatoire pour re-animation
                        const pathLength = path.getTotalLength();
                        
                        if (!isFinite(pathLength) || pathLength <= 0) {
                            console.warn(`❌ Longueur invalide pour ${id}: ${pathLength}`);
                            return;
                        }
                        
                        path.style.strokeDasharray = pathLength;
                        path.style.strokeDashoffset = pathLength; // Ligne invisible
                        path.style.transition = 'none'; // Pas d'animation pendant reset
                        
                        // 2. CONDITION : éviter re-animation si déjà visible
                        if (path.style.opacity === '0' || path.style.opacity === '') {
                            path.style.opacity = '0.8'; // Rendre visible
                            
                            // 3. ANIMATION après petit délai
                            this.setAnimationTimeout(() => {
                                if (!this.isAnimationActive(animationId)) return;
                                if (path && path.parentNode) {
                                    path.style.transition = 'stroke-dashoffset 1s ease-in-out';
                                    path.style.strokeDashoffset = 0; // Se dessine progressivement
                                }
                            }, 100, animationId);
                            
                            console.log(`🎨 Connexion ${id} tracée (longueur: ${Math.round(pathLength)}px)`);
                        }
                    } catch (error) {
                        console.error(`❌ Erreur lors de l'animation de ${id}:`, error);
                    }
                } else {
                    console.warn(`❌ Connexion ${id} non trouvée ou détachée du DOM (ID: ${connectionId})`);
                }
            });
        }
        
        animateSection1(animationId) {
            console.log('▶️ Start anim 1', animationId.toString());
            if (!this.isAnimationActive(animationId)) {
                console.log('🚫 Section 1 animation annulée avant démarrage');
                return;
            }
            console.log('🎨 Section 1 animation séquentielle - DÉMARRAGE');
            console.log('🔍 DEBUG Section 1 - isAnimating:', this.isAnimating);
            console.log('🔍 DEBUG Section 1 - currentSection:', this.currentSection);
            
            let currentDelay = 0;
            
            // 1. PROBLÈMES s'allument UNE PAR UNE
            this.setAnimationTimeout(() => this.activateTile('devis', 1), currentDelay += 500, animationId);
            this.setAnimationTimeout(() => this.activateTile('materiaux', 1), currentDelay += 300, animationId);
            this.setAnimationTimeout(() => this.activateTile('temps', 1), currentDelay += 300, animationId);
            
            // 2. CONNEXIONS vers solution (attendre 500ms puis laisser 1s pour le tracé)
            this.setAnimationTimeout(() => {
                if (!this.isAnimationActive(animationId)) return;
                console.log('🔗 Connexions problèmes → solution');
                this.showConnectionsWithDelay(['devis-marge', 'materiaux-marge', 'temps-marge'], animationId, 150);
            }, currentDelay += 500, animationId);
            
            // 3. SOLUTION s'allume APRÈS que les connexions soient tracées (1s + délai)
            this.setAnimationTimeout(() => this.activateTile('marge', 1), currentDelay += 1200, animationId);
            
            // 4. CONNEXION finale (attendre 400ms puis laisser 1s pour le tracé)
            this.setAnimationTimeout(() => {
                if (!this.isAnimationActive(animationId)) return;
                console.log('🔗 Connexion solution → bénéfice');
                this.showConnections(['marge-decisions'], animationId);
            }, currentDelay += 400, animationId);
            
            // 5. BÉNÉFICE final APRÈS que la connexion soit tracée
            this.setAnimationTimeout(() => this.activateTile('decisions', 1), currentDelay += 1100, animationId);
            
            // Marquer la fin de l'animation
            this.setAnimationTimeout(() => {
                if (!this.isAnimationActive(animationId)) return;
                this.isAnimating = false;
                console.log('🏁 Animation Section 1 terminée');
            }, currentDelay += 500, animationId);
        }
        
        animateSection2(animationId) {
            console.log('▶️ Start anim 2', animationId.toString());
            if (!this.isAnimationActive(animationId)) {
                console.log('🚫 Section 2 animation annulée avant démarrage');
                return;
            }
            console.log('🎨 Section 2 animation séquentielle - DÉMARRAGE');
            
            let currentDelay = 0;
            
            // 1. PROBLÈMES s'allument UNE PAR UNE
            this.setAnimationTimeout(() => this.activateTile('fournisseurs', 2), currentDelay += 500, animationId);
            this.setAnimationTimeout(() => this.activateTile('charges', 2), currentDelay += 300, animationId);
            this.setAnimationTimeout(() => this.activateTile('factures', 2), currentDelay += 300, animationId);
            
            // 2. CONNEXIONS vers solution (attendre 500ms puis laisser 1s pour le tracé)
            this.setAnimationTimeout(() => {
                if (!this.isAnimationActive(animationId)) return;
                console.log('🔗 Connexions problèmes → solution');
                this.showConnectionsWithDelay(['fournisseurs-previsionnel', 'charges-previsionnel', 'factures-previsionnel'], animationId, 150);
            }, currentDelay += 500, animationId);
            
            // 3. SOLUTION s'allume APRÈS que les connexions soient tracées (1s + délai)
            this.setAnimationTimeout(() => this.activateTile('previsionnel', 2), currentDelay += 1200, animationId);
            
            // 4. CONNEXION finale (attendre 400ms puis laisser 1s pour le tracé)
            this.setAnimationTimeout(() => {
                if (!this.isAnimationActive(animationId)) return;
                console.log('🔗 Connexion solution → bénéfice');
                this.showConnections(['previsionnel-serenite'], animationId);
            }, currentDelay += 400, animationId);
            
            // 5. BÉNÉFICE final APRÈS que la connexion soit tracée
            this.setAnimationTimeout(() => this.activateTile('serenite', 2), currentDelay += 1100, animationId);
            
            // Marquer la fin de l'animation
            this.setAnimationTimeout(() => {
                if (!this.isAnimationActive(animationId)) return;
                this.isAnimating = false;
                console.log('🏁 Animation Section 2 terminée');
            }, currentDelay += 500, animationId);
        }
        
        animateSection3(animationId) {
            console.log('▶️ Start anim 3', animationId.toString());
            if (!this.isAnimationActive(animationId)) {
                console.log('🚫 Section 3 animation annulée avant démarrage');
                return;
            }
            console.log('🎨 Section 3 animation séquentielle - DÉMARRAGE');
            
            let currentDelay = 0;
            
            // 1. PROBLÈME central avec pulse
            this.setAnimationTimeout(() => {
                if (!this.isAnimationActive(animationId)) return;
                const doute = document.querySelector('#stratego-final-map .tile[data-tile="doute"][data-section="3"]');
                if (doute) {
                    doute.style.opacity = '1';
                    doute.classList.add('active', 'pulse');
                    console.log('✨ Tuile DOUTE activée (avec pulse)');
                }
            }, currentDelay += 500, animationId);
            
            // 2. CONNEXIONS depuis le doute (attendre 400ms puis laisser 1s pour le tracé)
            this.setAnimationTimeout(() => {
                if (!this.isAnimationActive(animationId)) return;
                console.log('🔗 Connexions doute → problèmes');
                this.showConnectionsWithDelay(['doute-investissement', 'doute-recrutement'], animationId, 150);
            }, currentDelay += 400, animationId);
            
            // 3. PROBLÈMES résultants APRÈS que les connexions soient tracées
            this.setAnimationTimeout(() => this.activateTile('investissement', 3), currentDelay += 1100, animationId);
            this.setAnimationTimeout(() => this.activateTile('recrutement', 3), currentDelay += 300, animationId);
            
            // 4. SOLUTION conseil (attendre 500ms)
            this.setAnimationTimeout(() => this.activateTile('conseil', 3), currentDelay += 500, animationId);
            
            // 5. CONNEXION solution → doute (attendre 400ms puis laisser 1s pour le tracé)
            this.setAnimationTimeout(() => {
                if (!this.isAnimationActive(animationId)) return;
                console.log('🔗 Connexion conseil → doute');
                this.showConnections(['conseil-doute'], animationId);
            }, currentDelay += 400, animationId);
            
            // 6. CONNEXION finale vers bénéfice (attendre 1s puis laisser 1s pour le tracé)
            this.setAnimationTimeout(() => {
                if (!this.isAnimationActive(animationId)) return;
                console.log('🔗 Connexion conseil → croissance');
                this.showConnections(['conseil-croissance'], animationId);
            }, currentDelay += 1000, animationId);
            
            // 7. BÉNÉFICE final APRÈS que la connexion soit tracée
            this.setAnimationTimeout(() => this.activateTile('croissance', 3), currentDelay += 1100, animationId);
            
            // Marquer la fin de l'animation
            this.setAnimationTimeout(() => {
                if (!this.isAnimationActive(animationId)) return;
                this.isAnimating = false;
                console.log('🏁 Animation Section 3 terminée');
            }, currentDelay += 500, animationId);
        }
        

        
        bindEvents() {
            // Événements supprimés avec les connexions
        }
        
        destroy() {
            if (this.animationInterval) {
                clearInterval(this.animationInterval);
            }
            // Plus de scroll observer à nettoyer
        }
        
        // PROTECTION AGRESSIVE contre les scripts externes
        setupActiveProtection() {
            console.log('🛡️ Installation de la protection agressive des classes active');
            
            const self = this; // Capture du contexte
            
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'attributes' && mutation.attributeName === 'class') {
                        const tile = mutation.target;
                        const tileName = tile.dataset.tile;
                        const tileSection = parseInt(tile.dataset.section);
                        const oldClasses = mutation.oldValue || '';
                        const newClasses = tile.className;
                        
                        // PROTECTION DÉSACTIVÉE TEMPORAIREMENT - causait l'instabilité
                        if (false && oldClasses.includes('active') && !newClasses.includes('active') && 
                            tileSection === self.currentSection && !self.isAnimating) {
                            
                            console.log(`🛡️ PROTECTION: Restauration ${tileName} (section ${tileSection})`);
                            
                            // Restaurer immédiatement la classe active
                            setTimeout(() => {
                                if (!tile.classList.contains('active')) {
                                    tile.classList.add('active');
                                }
                            }, 10); // Petit délai pour éviter les conflits
                        }
                    }
                });
            });
            
            // Observer toutes les tuiles
            const tiles = document.querySelectorAll('#stratego-final-map .tile');
            tiles.forEach(tile => {
                observer.observe(tile, {
                    attributes: true,
                    attributeOldValue: true,
                    attributeFilter: ['class']
                });
            });
            
            console.log(`🛡️ Protection installée sur ${tiles.length} tuiles`);
            
            // PROTECTION DÉSACTIVÉE TEMPORAIREMENT - causait l'instabilité des animations
            // setInterval(() => {
            //     if (self.currentSection && !self.isAnimating) {
            //         const currentTiles = document.querySelectorAll(`#stratego-final-map .tile[data-section="${self.currentSection}"]`);
            //         currentTiles.forEach(tile => {
            //             if (!tile.classList.contains('active')) {
            //                 console.log(`🔧 RÉPARATION: ${tile.dataset.tile} manquait la classe active`);
            //                 tile.classList.add('active');
            //             }
            //         });
            //     }
            // }, 500);
        }
        
        // PROTECTION CONTRE CSS EXTERNE ET SCRIPTS EXTERNES
        protectAgainstExternalCSS() {
            console.log('🛡️ Protection contre CSS externe et scripts externes activée');
            
            // Désactiver les animations CSS externes sur nos éléments
            const style = document.createElement('style');
            style.textContent = `
                #stratego-final-map .tile,
                #stratego-final-map .tile * {
                    animation-name: none !important;
                    animation-duration: 0s !important;
                    animation-delay: 0s !important;
                    animation-iteration-count: 1 !important;
                    animation-fill-mode: none !important;
                    transform: none !important;
                    transition: opacity 0.3s ease !important;
                }
                
                #stratego-final-map .connections-svg,
                #stratego-final-map .connections-svg * {
                    animation: none !important;
                    transform: none !important;
                }
            `;
            document.head.appendChild(style);
            
            // INTERCEPTER LE SCRIPT EXTERNE updateTiles
            this.interceptExternalUpdateTiles();
            
            // Protection par intervalle contre les interférences
            setInterval(() => {
                document.querySelectorAll('#stratego-final-map .tile').forEach(tile => {
                    // Supprimer les classes d'animation externe qui pourraient être ajoutées
                    tile.classList.remove('fade-in-left-delay', 'go-animate');
                    
                    // Forcer nos styles
                    if (tile.style.animation && tile.style.animation !== 'none') {
                        tile.style.animation = 'none';
                    }
                    if (tile.style.transform && tile.style.transform !== 'none') {
                        tile.style.transform = 'none';
                    }
                });
            }, 1000);
        }
        
        // INTERCEPTER LE SCRIPT EXTERNE QUI SUPPRIME NOS CLASSES ACTIVE
        interceptExternalUpdateTiles() {
            console.log('🔒 Interception du script externe updateTiles');
            
            // Sauvegarder la fonction querySelector originale
            const originalQuerySelectorAll = document.querySelectorAll;
            
            // Remplacer querySelectorAll pour intercepter les sélections de '.tile'
            document.querySelectorAll = function(selector) {
                const result = originalQuerySelectorAll.call(this, selector);
                
                // Si on sélectionne '.tile', exclure nos tuiles de Stratégo
                if (selector === '.tile') {
                    console.log('🚫 Script externe tente de sélectionner .tile - BLOQUÉ');
                    
                    // Retourner seulement les tuiles qui ne sont PAS dans notre map
                    const filteredResult = Array.from(result).filter(tile => {
                        return !tile.closest('#stratego-final-map');
                    });
                    
                    // Convertir en NodeList-like object
                    const nodeList = {
                        length: filteredResult.length,
                        forEach: function(callback) {
                            filteredResult.forEach(callback);
                        }
                    };
                    
                    // Ajouter les éléments comme propriétés indexées
                    filteredResult.forEach((item, index) => {
                        nodeList[index] = item;
                    });
                    
                    return nodeList;
                }
                
                return result;
            };
        }
        
        // RECALCULER LES COORDONNÉES DES CONNEXIONS EXISTANTES
        recalculateConnectionPositions() {
            console.log('🔄 Recalcul des positions des connexions');
            
            const svg = document.querySelector('#stratego-final-map .connections-svg');
            if (!svg) {
                console.warn('❌ SVG non trouvé pour recalcul - Recréation automatique');
                this.createAllConnections();
                return;
            }
            
            // Vérifier que le SVG est dans le DOM et visible
            if (!svg.parentNode || svg.getBoundingClientRect().width === 0) {
                console.warn('❌ SVG non visible ou détaché - Recréation automatique');
                this.createAllConnections();
                return;
            }
            
            const connections = document.querySelectorAll('#stratego-final-map .auto-connection');
            let successCount = 0;
            
            connections.forEach(path => {
                const fromTile = path.dataset.from;
                const toTile = path.dataset.to;
                
                if (!fromTile || !toTile) {
                    console.warn(`❌ Données manquantes pour path ${path.id}`);
                    return;
                }
                
                const fromElement = document.querySelector(`#stratego-final-map .tile[data-tile="${fromTile}"]`);
                const toElement = document.querySelector(`#stratego-final-map .tile[data-tile="${toTile}"]`);
                
                if (!fromElement || !toElement) {
                    console.warn(`❌ Tuiles manquantes pour recalcul: ${fromTile} ou ${toTile}`);
                    return;
                }
                
                const svgRect = svg.getBoundingClientRect();
                const fromRect = fromElement.getBoundingClientRect();
                const toRect = toElement.getBoundingClientRect();
                
                const x1 = Math.round(fromRect.left + fromRect.width/2 - svgRect.left);
                const y1 = Math.round(fromRect.top + fromRect.height/2 - svgRect.top);
                const x2 = Math.round(toRect.left + toRect.width/2 - svgRect.left);
                const y2 = Math.round(toRect.top + toRect.height/2 - svgRect.top);
                
                if (!isNaN(x1) && !isNaN(y1) && !isNaN(x2) && !isNaN(y2) &&
                    isFinite(x1) && isFinite(y1) && isFinite(x2) && isFinite(y2)) {
                    try {
                        path.setAttribute('d', `M ${x1} ${y1} L ${x2} ${y2}`);
                        successCount++;
                        console.log(`✅ Connexion ${fromTile}→${toTile} recalculée: (${x1},${y1}) → (${x2},${y2})`);
                    } catch (error) {
                        console.error(`❌ Erreur lors du recalcul de ${fromTile}→${toTile}:`, error);
                    }
                } else {
                    console.error(`❌ Coordonnées invalides pour recalcul ${fromTile}→${toTile}: (${x1},${y1}) → (${x2},${y2})`);
                }
            });
            
            console.log(`✅ ${successCount}/${connections.length} connexions recalculées`);
        }
        
        // UTILITAIRE pour activer une tuile avec opacité et classe
        activateTile(tileId, sectionId) {
            const tile = document.querySelector(`#stratego-final-map .tile[data-tile="${tileId}"][data-section="${sectionId}"]`);
            if (tile) {
                tile.style.opacity = '1';
                tile.classList.add('active');
                console.log(`✨ Tuile ${tileId.toUpperCase()} activée`);
                return true;
            }
            return false;
        }
        
        // SYSTÈME D'ANIMATION AVEC ID UNIQUE
        createAnimationId() {
            return Symbol('animation-' + Date.now());
        }
        
        // Vérifier si une animation est toujours active
        isAnimationActive(animationId) {
            const active = this.currentAnimationId === animationId && 
                           this.currentAnimationId !== null && 
                           animationId !== null && 
                           animationId !== undefined;
            if (!active && animationId) {
                console.log("🚫 Animation annulée:", animationId.toString());
            }
            return active;
        }
        
        // setTimeout sécurisé qui vérifie l'ID d'animation
        setAnimationTimeout(callback, delay, animationId) {
            return setTimeout(() => {
                // Vérifier que cette animation est toujours active
                if (!this.isAnimationActive(animationId)) {
                    console.log('🚫 Animation timeout abandonné (animation inactive)');
                    return;
                }
                callback();
            }, delay);
        }
        
        // Stopper l'animation en cours
        stopCurrentAnimation() {
            if (this.currentAnimationId) {
                console.log('🛑 Animation en cours stoppée:', this.currentAnimationId.toString());
                this.currentAnimationId = null;
                this.isAnimating = false;
                
                // Force stop visuel : arrêter toutes les transitions CSS
                document.querySelectorAll('#stratego-final-map .auto-connection').forEach(path => {
                    path.style.transition = 'none';
                });
            }
        }
        
        // NOUVEAU : Reset seulement les tuiles de la section courante pour répétition
        resetCurrentSectionTiles(sectionNumber) {
            console.log(`🔄 Reset des tuiles de la section ${sectionNumber} pour répétition`);
            
            // Désactiver toutes les tuiles de cette section
            document.querySelectorAll(`#stratego-final-map .tile[data-section="${sectionNumber}"]`).forEach(tile => {
                tile.classList.remove('active', 'pulse', 'glow');
                tile.style.opacity = '0.3';
                tile.style.transition = 'opacity 0.3s ease';
            });
            
            // Reset toutes les connexions
            document.querySelectorAll('#stratego-final-map .auto-connection').forEach(path => {
                path.style.opacity = '0';
                path.style.transition = 'none';
                if (path.getTotalLength) {
                    try {
                        const pathLength = path.getTotalLength();
                        path.style.strokeDasharray = pathLength;
                        path.style.strokeDashoffset = pathLength;
                    } catch (e) {
                        // Ignore les erreurs de getTotalLength
                    }
                }
            });
            
            console.log(`✅ Reset terminé pour section ${sectionNumber}`);
        }
        
        // CRÉATION AUTOMATIQUE DES CONNEXIONS
        createAllConnections() {
            console.log('🔧 Création automatique des connexions');
            
            // Étape 1 : Créer le SVG de manière plus robuste
            const container = document.querySelector('#stratego-final-map .single-interactive-map');
            if (!container) {
                console.error('❌ Container principal non trouvé !');
                return;
            }
            
            // Vérifier si le SVG existe déjà
            let svg = container.querySelector('.connections-svg');
            if (svg) {
                console.log('🔄 SVG existant trouvé, nettoyage...');
                // Nettoyer le contenu existant au lieu de supprimer le SVG
                svg.innerHTML = '';
            } else {
                console.log('🆕 Création d\'un nouveau SVG...');
                // Créer le nouveau SVG
                svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svg.classList.add('connections-svg');
                svg.style.cssText = `
                    position: absolute !important;
                    top: 0 !important;
                    left: 0 !important;
                    width: 100% !important;
                    height: 100% !important;
                    z-index: 999 !important;
                    pointer-events: none !important;
                    overflow: visible !important;
                `;
                
                // Ajouter un attribut pour identifier notre SVG
                svg.setAttribute('data-stratego-svg', 'true');
                
                container.appendChild(svg);
            }
            
            console.log('✅ SVG préparé');
            
            // Attendre que le SVG soit bien dans le DOM
            setTimeout(() => {
                this.createConnectionPaths(svg);
            }, 100);
        }
        
        createConnectionPaths(svg) {
            // Vérifier que le SVG est toujours là
            if (!svg || !svg.parentNode) {
                console.error('❌ SVG disparu du DOM, nouvelle tentative...');
                this.createAllConnections();
                return;
            }
            
            // Étape 2 : Définir toutes les connexions
            const connections = [
                // Section 1 - Rentabilité
                { from: 'devis', to: 'marge', color: '#bf9b30', width: '3' },
                { from: 'materiaux', to: 'marge', color: '#bf9b30', width: '3' },
                { from: 'temps', to: 'marge', color: '#bf9b30', width: '3' },
                { from: 'marge', to: 'decisions', color: '#3a8eff', width: '3' },
                
                // Section 2 - Trésorerie
                { from: 'fournisseurs', to: 'previsionnel', color: '#bf9b30', width: '3' },
                { from: 'charges', to: 'previsionnel', color: '#bf9b30', width: '3' },
                { from: 'factures', to: 'previsionnel', color: '#bf9b30', width: '3' },
                { from: 'previsionnel', to: 'serenite', color: '#3a8eff', width: '3' },
                
                // Section 3 - Croissance  
                { from: 'doute', to: 'investissement', color: '#bf9b30', width: '3' },
                { from: 'doute', to: 'recrutement', color: '#bf9b30', width: '3' },
                { from: 'conseil', to: 'doute', color: '#bf9b30', width: '3' },
                { from: 'conseil', to: 'croissance', color: '#3a8eff', width: '3' }
            ];
            
            // Étape 3 : Créer chaque connexion avec validation robuste
            let successCount = 0;
            connections.forEach(conn => {
                if (this.createSingleConnection(svg, conn.from, conn.to, conn.color, conn.width)) {
                    successCount++;
                }
            });
            
            console.log(`✅ ${successCount}/${connections.length} connexions créées avec succès`);
            
            // Protéger le SVG contre la suppression
            this.protectSVG(svg);
            
            // DEBUG : Lister tous les IDs créés
            console.log('🔍 IDs de connexions créés:');
            document.querySelectorAll('#stratego-final-map .auto-connection').forEach(path => {
                console.log(`  - ${path.id} (${path.dataset.from} → ${path.dataset.to})`);
            });
        }
        
        // Nouvelle fonction pour protéger le SVG
        protectSVG(svg) {
            // Observer les mutations pour détecter si le SVG est supprimé
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'childList') {
                        mutation.removedNodes.forEach((node) => {
                            if (node === svg || (node.querySelector && node.querySelector('.connections-svg'))) {
                                console.warn('🚨 SVG supprimé du DOM ! Recréation...');
                                observer.disconnect();
                                setTimeout(() => {
                                    this.createAllConnections();
                                }, 100);
                            }
                        });
                    }
                });
            });
            
            const container = svg.parentNode;
            if (container) {
                observer.observe(container, {
                    childList: true,
                    subtree: true
                });
            }
        }
        
        createSingleConnection(svg, fromTile, toTile, color = '#bf9b30', width = '3') {
            const fromElement = document.querySelector(`#stratego-final-map .tile[data-tile="${fromTile}"]`);
            const toElement = document.querySelector(`#stratego-final-map .tile[data-tile="${toTile}"]`);
            
            if (!fromElement || !toElement) {
                console.warn(`❌ Tuiles manquantes: ${fromTile} ou ${toTile}`);
                return false;
            }
            
            // Vérifier que le SVG est toujours valide
            if (!svg || !svg.parentNode) {
                console.error(`❌ SVG invalide lors de la création de ${fromTile}→${toTile}`);
                return false;
            }
            
            // Calculer les coordonnées avec validation robuste
            const svgRect = svg.getBoundingClientRect();
            const fromRect = fromElement.getBoundingClientRect();
            const toRect = toElement.getBoundingClientRect();
            
            // Vérifier que tous les rectangles sont valides
            if (svgRect.width === 0 || svgRect.height === 0 || 
                fromRect.width === 0 || fromRect.height === 0 ||
                toRect.width === 0 || toRect.height === 0) {
                console.warn(`⏸️ Éléments pas encore rendus, attente... (${fromTile}→${toTile})`);
                // Réessayer plus tard
                setTimeout(() => {
                    this.createSingleConnection(svg, fromTile, toTile, color, width);
                }, 200);
                return false;
            }
            
            // Calcul sécurisé avec arrondi et validation
            let x1 = Math.round(fromRect.left + fromRect.width/2 - svgRect.left);
            let y1 = Math.round(fromRect.top + fromRect.height/2 - svgRect.top);
            let x2 = Math.round(toRect.left + toRect.width/2 - svgRect.left);
            let y2 = Math.round(toRect.top + toRect.height/2 - svgRect.top);
            
            // Validation stricte des coordonnées
            if (isNaN(x1) || isNaN(y1) || isNaN(x2) || isNaN(y2) ||
                !isFinite(x1) || !isFinite(y1) || !isFinite(x2) || !isFinite(y2)) {
                console.error(`❌ Coordonnées invalides pour ${fromTile}-${toTile}: (${x1},${y1}) → (${x2},${y2})`);
                return false;
            }
            
            // Vérifier que les coordonnées sont dans des limites raisonnables
            const maxCoord = 10000; // Limite raisonnable
            if (Math.abs(x1) > maxCoord || Math.abs(y1) > maxCoord || 
                Math.abs(x2) > maxCoord || Math.abs(y2) > maxCoord) {
                console.error(`❌ Coordonnées hors limites pour ${fromTile}-${toTile}: (${x1},${y1}) → (${x2},${y2})`);
                return false;
            }
            
            // Debug des coordonnées (seulement si valides)
            console.log(`🔍 Coordonnées ${fromTile}→${toTile}: (${x1},${y1}) → (${x2},${y2})`);
            
            // Créer le path avec ID unique et validation
            const connectionId = `connection-${fromTile}-${toTile}`;
            
            // Vérifier si la connexion existe déjà
            let path = document.getElementById(connectionId);
            if (path) {
                // Mettre à jour la connexion existante
                path.setAttribute('d', `M ${x1} ${y1} L ${x2} ${y2}`);
                console.log(`🔄 Connexion ${connectionId} mise à jour`);
                return true;
            }
            
            // Créer une nouvelle connexion
            path = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            path.id = connectionId; // ✅ ID unique
            path.setAttribute('d', `M ${x1} ${y1} L ${x2} ${y2}`);
            path.setAttribute('stroke', color);
            path.setAttribute('stroke-width', width);
            path.setAttribute('fill', 'none');
            path.setAttribute('opacity', '0'); // Masqué par défaut
            path.classList.add('auto-connection');
            path.dataset.from = fromTile; // Gardé pour compatibilité
            path.dataset.to = toTile;
            
            try {
                svg.appendChild(path);
                console.log(`✅ Connexion ${connectionId} créée avec succès`);
                return true;
            } catch (error) {
                console.error(`❌ Erreur lors de l'ajout de ${connectionId}:`, error);
                return false;
            }
        }
    }
    
    // Initialisation
    function initializeMap() {
        if (document.querySelector('#stratego-final-map')) {
            window.finalMapController = new FinalMapController();
            window.finalMapController.init();
        }
    }
    
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializeMap);
    } else {
        initializeMap();
    }
    
    // Nettoyage à la fermeture
    window.addEventListener('beforeunload', () => {
        if (window.finalMapController) {
            window.finalMapController.destroy();
        }
    });
})();
</script>